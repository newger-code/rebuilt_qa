<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Seller Questionnaire ‚Äî Sidebar</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
  *{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',-apple-system,sans-serif;}
  body{background:#E5E7EB;display:flex;justify-content:center;align-items:flex-start;padding:16px;min-height:100vh;}
  .frame{width:340px;height:700px;background:#fff;border:1px solid #CBD5E1;border-radius:6px;
    display:flex;flex-direction:column;overflow:hidden;box-shadow:0 1px 4px rgba(0,0,0,.06);}

  .hdr{padding:6px 10px;border-bottom:1px solid #E2E8F0;background:#F8FAFC;flex-shrink:0;
    display:flex;align-items:center;justify-content:space-between;}
  .hdr-t{font-size:12px;font-weight:700;color:#1E293B;}
  .hdr-stat{font-size:10px;color:#94A3B8;}

  /* ‚îÄ‚îÄ Gauge ‚îÄ‚îÄ */
  .gauge{flex-shrink:0;padding:8px 10px 6px;border-bottom:1px solid #E2E8F0;background:#F8FAFC;}
  .gauge-inputs{display:flex;gap:6px;margin-bottom:6px;}
  .gauge-inputs label{font-size:9px;color:#64748B;font-weight:600;text-transform:uppercase;letter-spacing:.3px;}
  .gauge-inputs input{display:block;width:100%;padding:2px 5px;border:1px solid #CBD5E1;border-radius:3px;
    font-size:11px;font-weight:600;outline:none;font-family:inherit;margin-top:1px;}
  .gauge-inputs input:focus{border-color:#2563EB;box-shadow:0 0 0 1px rgba(37,99,235,.15);}
  .gauge-bar{position:relative;height:12px;border-radius:6px;overflow:visible;
    background:linear-gradient(90deg,#EF4444 0%,#F97316 25%,#FBBF24 45%,#34D399 70%,#059669 100%);}
  .gauge-thumb{position:absolute;top:-2px;width:6px;height:16px;background:#1E293B;border-radius:3px;
    transition:left 500ms cubic-bezier(.25,.46,.45,.94);box-shadow:0 0 0 2px #fff,0 1px 3px rgba(0,0,0,.2);}
  .gauge-letters{display:flex;justify-content:space-between;margin-top:2px;padding:0 2px;}
  .gauge-letters span{font-size:8px;font-weight:800;color:#94A3B8;width:16px;text-align:center;}
  .gauge-letters span.active{color:#1E293B;font-size:9px;}
  .gauge-bottom{display:flex;align-items:baseline;justify-content:space-between;margin-top:4px;}
  .gauge-grade{font-size:20px;font-weight:800;line-height:1;}
  .gA{color:#059669;}.gB{color:#10B981;}.gC{color:#EAB308;}.gD{color:#F97316;}.gF{color:#EF4444;}
  .gauge-desc{font-size:10px;color:#64748B;margin-left:5px;}
  .gauge-cost{text-align:right;}
  .gauge-cost-val{font-size:13px;font-weight:800;color:#1E293B;}
  .gauge-cost-lbl{font-size:8px;color:#94A3B8;text-transform:uppercase;letter-spacing:.3px;}

  /* ‚îÄ‚îÄ Scrollable body ‚îÄ‚îÄ */
  .body{flex:1;overflow-y:auto;overflow-x:hidden;}
  .body::-webkit-scrollbar{width:3px;}
  .body::-webkit-scrollbar-thumb{background:#CBD5E1;border-radius:2px;}

  /* ‚îÄ‚îÄ Sections ‚îÄ‚îÄ */
  .sec{border-bottom:1px solid #E2E8F0;}
  .sec-h{padding:5px 10px;display:flex;align-items:center;justify-content:space-between;
    cursor:pointer;background:#1E3A5F;user-select:none;position:sticky;top:0;z-index:2;}
  .sec-h:hover{background:#17304F;}
  .sec-t{font-size:11px;font-weight:700;color:#E2E8F0;display:flex;align-items:center;gap:4px;}
  .sec-b{font-size:9px;padding:1px 5px;border-radius:8px;font-weight:600;}
  .sec-b.done{background:#DCFCE7;color:#166534;}.sec-b.part{background:#FEF3C7;color:#92400E;}
  .sec-b.mt{background:rgba(255,255,255,.15);color:#94A3B8;}
  .sec-arr{font-size:9px;color:#94A3B8;transition:transform 120ms;}
  .sec-h .sec-arr{color:#CBD5E1;}
  .sec-arr.open{transform:rotate(90deg);}
  /* Required section ‚Äî emerald to stand apart from navy */
  .sec-h.req-h{background:#065F46;}
  .sec-h.req-h:hover{background:#064E3B;}
  .sec-body{padding:2px 10px 6px;}

  /* ‚îÄ‚îÄ Question rows zebra ‚îÄ‚îÄ */
  .q{padding:4px 0;}
  .q.alt{background:#F8FAFC;margin:0 -10px;padding:4px 10px;}
  .q-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:2px;}
  .q-lbl{font-size:11px;font-weight:600;color:#334155;}
  .q-req{color:#EF4444;font-size:8px;vertical-align:super;}
  .q-chk{color:#10B981;font-size:9px;margin-left:3px;}

  /* ‚îÄ‚îÄ Pills ‚îÄ‚îÄ */
  .pills{display:flex;flex-wrap:wrap;gap:2px;}
  .p{display:inline-flex;align-items:center;padding:2px 7px;border:1px solid #CBD5E1;border-radius:3px;
    font-size:10px;cursor:pointer;transition:all 80ms;background:#fff;color:#475569;user-select:none;}
  .p:hover{border-color:#93C5FD;background:#EFF6FF;}
  .p.on{border-color:#2563EB;background:#DBEAFE;color:#1E40AF;font-weight:600;}
  .p.neg.on{border-color:#EF4444;background:#FEE2E2;color:#991B1B;}

  /* ‚îÄ‚îÄ Checkbox list ‚îÄ‚îÄ */
  .cbl{display:grid;grid-template-columns:1fr 1fr;gap:1px 4px;}
  .cb{display:flex;align-items:center;gap:4px;padding:2px 0;cursor:pointer;user-select:none;font-size:10px;color:#475569;}
  .cb:hover{color:#1E40AF;}
  .cb .bx{width:13px;height:13px;border:1.5px solid #94A3B8;border-radius:2px;flex-shrink:0;
    display:flex;align-items:center;justify-content:center;font-size:8px;transition:all 80ms;background:#fff;}
  .cb.on .bx{background:#7C3AED;border-color:#7C3AED;color:#fff;}
  .cb.on{color:#5B21B6;font-weight:500;}

  /* ‚îÄ‚îÄ Inputs ‚îÄ‚îÄ */
  .inp{padding:2px 6px;border:1px solid #CBD5E1;border-radius:3px;font-size:11px;font-family:inherit;
    outline:none;transition:border-color 80ms;}
  .inp:focus{border-color:#2563EB;box-shadow:0 0 0 1px rgba(37,99,235,.15);}
  .inp-price{width:110px;font-weight:600;}
  textarea.inp{resize:none;width:100%;}

  /* ‚îÄ‚îÄ Combo row (pills + year) ‚îÄ‚îÄ */
  .combo-row .pills{margin-bottom:3px;}
  .yr-row{display:flex;align-items:center;gap:4px;}
  .yr-hint{font-size:8px;color:#B0B8C4;font-weight:400;letter-spacing:.2px;white-space:nowrap;}
  .yr-pills{display:flex;gap:2px;}
  .yr-pills .p{padding:1px 5px;font-size:9px;}

  .probe{font-size:9px;padding:2px 6px;background:#FEF3C7;border:1px solid #FDE68A;border-radius:2px;
    color:#92400E;margin-top:2px;}

  /* ‚îÄ‚îÄ Notes section ‚îÄ‚îÄ */
  .notes-sec{padding:8px 10px 4px;border-top:1px solid #E2E8F0;}
  .notes-lbl{font-size:10px;font-weight:600;color:#64748B;text-transform:uppercase;letter-spacing:.3px;margin-bottom:4px;}
  .notes-box{width:100%;min-height:48px;max-height:80px;padding:5px 7px;border:1px solid #CBD5E1;border-radius:4px;
    font-size:11px;font-family:inherit;outline:none;resize:none;color:#334155;line-height:1.4;}
  .notes-box:focus{border-color:#2563EB;box-shadow:0 0 0 1px rgba(37,99,235,.15);}
  .notes-box::placeholder{color:#94A3B8;}

  /* ‚îÄ‚îÄ Footer ‚Äî Save Offer ‚îÄ‚îÄ */
  .foot{flex-shrink:0;padding:0;}
  .foot-div{height:2px;background:#1E293B;}
  .btn-offer{display:block;width:100%;padding:10px 0;background:#06B6D4;color:#fff;border:none;
    font-size:13px;font-weight:700;cursor:pointer;transition:background 80ms;letter-spacing:.3px;
    border-radius:0 0 5px 5px;}
  .btn-offer:hover{background:#0891B2;}
</style>
</head>
<body>
<div class="frame"><div id="w" style="display:flex;flex-direction:column;height:100%;"></div></div>
<script>
// ================================================================
// RENO FORMULA ‚Äî exact match to spec
// ================================================================
function renoCalc(yearBuilt, sqft, condLetter){
  const age = 2026 - yearBuilt;
  if(age < 0) return 0;

  // Age factor
  let factor;
  if(age <= 40){
    factor = age / 20.3;
  } else {
    factor = 1.97 + (Math.sqrt(age) - Math.sqrt(40)) * 0.31;
  }

  // Effective sqft
  const effSqft = Math.max(sqft, 1200);

  // Condition multiplier
  const mults = {A:2, B:4, C:7, D:10, F:13};
  const mult = mults[condLetter] || 10;

  // Base cost
  let base = factor * effSqft * mult;

  // D/F boost for age < 40
  let boost = 0;
  if(age < 40){
    if(condLetter === 'D') boost = 20000 * (40 - age) / 40;
    if(condLetter === 'F') boost = 30000 * (40 - age) / 40;
  }

  return Math.round(base + boost);
}

// ================================================================
// SCORING ENGINE ‚Äî weighted by actual replacement cost & impact
// ================================================================
// Roof $8-15K, Foundation $5-30K, HVAC $5-12K, Furnace $3-8K,
// Kitchen $10-30K, Bath $5-15K, Windows $8-15K, Plumbing $3-10K,
// Electrical $3-8K, Siding $5-12K, Flooring $3-8K,
// Water Heater $1-2K (lowest impact)
const SC = {
  // EXTERIOR ‚Äî big-ticket structural
  roof_age:{'<5':8,'5-10':4,'10-15':0,'15-20':-4,'20+':-8},
  roof_lk:{'None':5,'Past fix':0,'Active':-12,'Unsure':-3},
  windows:{'Vinyl':5,'Mix':1,'Orig':-4,'Unsure':-2},
  siding:{'Good':4,'Fair':0,'Poor':-4,'Unsure':-1},
  found_t:{'Slab':1,'Crawl':0,'Bsmt':0,'Unsure':-1},
  found_i:{'None':3,'Minor':-3,'Major':-15,'Unsure':-4},
  // SYSTEMS ‚Äî weighted by replacement cost
  hvac_age:{'<5':7,'5-10':3,'10-15':-2,'15+':-7},
  heat_src:{'Gas':2,'Electric':0,'Heat Pump':3,'Boiler':-2,'Unknown':-2},
  heat_age:{'<5':5,'5-10':2,'10-15':-2,'15+':-5},
  wh_age:{'<5':2,'5-10':0,'10+':-2},
  plumb:{'Updated':5,'Partial':1,'Orig':-5,'Unsure':-2},
  elec:{'Breakers':4,'Fuses':-6,'Unsure':-2},
  // INTERIOR ‚Äî weighted by reno cost
  kitchen:{'Updated':8,'Partial':1,'No':-5},
  kitchen_yr:{'<5':3,'5-10':1,'10+':-2},
  counter:{'Granite':3,'Formica':-1,'Laminate':-2,'Unknown':-1},
  baths:{'Updated':6,'Partial':1,'No':-4},
  baths_yr:{'<5':3,'5-10':1,'10+':-2},
  floor:{'Updated':4,'Partial':1,'Orig':-3},
  floor_yr:{'<5':2,'5-10':1,'10+':-1},
};

function calcScore(){
  let s = 40; // D baseline
  let pos=0, neg=0, answered=0;
  Object.keys(SC).forEach(k=>{
    const v = A[k];
    if(v && SC[k][v] !== undefined){
      const pts = SC[k][v];
      s += pts;
      answered++;
      if(pts > 0) pos++;
      else if(pts < 0) neg++;
    }
  });
  // Maintenance compound: someone who updates multiple things
  // likely maintains what we're NOT asking about too.
  // Neglect everywhere = deferred maintenance we can't see.
  if(answered >= 5){
    const posR = pos / answered;
    const negR = neg / answered;
    if(posR >= 0.65) s += Math.round((posR - 0.5) * 14);
    if(negR >= 0.65) s -= Math.round((negR - 0.5) * 14);
  }
  return Math.max(0, Math.min(100, s));
}

function scoreToLetter(s){
  if(s >= 80) return 'A';
  if(s >= 65) return 'B';
  if(s >= 50) return 'C';
  if(s >= 35) return 'D';
  return 'F';
}

function letterDesc(l){
  return {A:'Move-in ready',B:'Minor updates',C:'Moderate rehab',D:'Heavy renovation',F:'Gut / structural'}[l]||'';
}

function letterClass(l){ return 'g'+l; }

// ================================================================
// DATA
// ================================================================
const SECS=[
  {id:'req',t:'Required Info',qs:[
    {id:'motiv',lbl:'Motivation to Sell',type:'chk',req:true,
      opts:['Behind on Pmts','Pre-Foreclosure','Tax Liens','Bad Tenants','Tired Landlord','Vacant',
            'Inherited','Probate','Divorce','Downsizing','Relocating','Needs Repairs',
            'Code Violations','Job Loss','Medical','Bankruptcy','Retirement','Other']},
    {id:'ask_price',lbl:'Asking Price',type:'price',req:true},
    {id:'occ',lbl:'Occupancy',type:'sel',req:true,opts:['Vacant','Owner','Tenant','Unknown']},
    {id:'lease',lbl:'Lease',type:'sel',opts:['Mo-to-Mo','Fixed','Unknown'],showIf:{f:'occ',v:'Tenant'}},
    {id:'rent',lbl:'Rent Current?',type:'sel',opts:['Yes','Behind','Unknown'],showIf:{f:'occ',v:'Tenant'}},
  ]},
  {id:'ext',t:'Exterior',qs:[
    {id:'roof_age',lbl:'Roof Age',type:'sel',opts:['<5','5-10','10-15','15-20','20+'],
      probe:'Closer to 5, 10, or 20+?'},
    {id:'roof_lk',lbl:'Roof Leaks',type:'sel',opts:['None','Past fix','Active','Unsure'],neg:['Active']},
    {id:'windows',lbl:'Windows',type:'sel',opts:['Vinyl','Mix','Orig','Unsure']},
    {id:'siding',lbl:'Siding/Paint',type:'sel',opts:['Good','Fair','Poor','Unsure'],neg:['Poor']},
    {id:'found_t',lbl:'Foundation',type:'sel',opts:['Slab','Crawl','Bsmt','Unsure']},
    {id:'found_i',lbl:'Found. Issues',type:'sel',opts:['None','Minor','Major','Unsure'],neg:['Major']},
  ]},
  {id:'sys',t:'Systems',qs:[
    {id:'hvac_age',lbl:'A/C Age',type:'sel',opts:['<5','5-10','10-15','15+'],
      probe:'Closer to 5, 10, or 15+?'},
    {id:'heat_src',lbl:'Heat Source',type:'sel',opts:['Gas','Electric','Heat Pump','Boiler','Unknown']},
    {id:'heat_age',lbl:'Furnace Age',type:'sel',opts:['<5','5-10','10-15','15+']},
    {id:'wh_age',lbl:'Water Heater',type:'sel',opts:['<5','5-10','10+']},
    {id:'plumb',lbl:'Plumbing',type:'sel',opts:['Updated','Partial','Orig','Unsure']},
    {id:'elec',lbl:'Electrical',type:'sel',opts:['Breakers','Fuses','Unsure'],neg:['Fuses']},
  ]},
  {id:'int',t:'Interior',qs:[
    {id:'kitchen',lbl:'Kitchen Remodel',type:'sel',opts:['Updated','Partial','No'],yrId:'kitchen_yr'},
    {id:'counter',lbl:'Countertops',type:'sel',opts:['Granite','Formica','Laminate','Unknown']},
    {id:'baths',lbl:'Bath Remodel',type:'sel',opts:['Updated','Partial','No'],yrId:'baths_yr'},
    {id:'floor',lbl:'Flooring',type:'sel',opts:['Updated','Partial','Orig'],yrId:'floor_yr'},
  ]},
  {id:'bonus',t:'Bonus Intel',qs:[
    {id:'timeline',lbl:'Timeline',type:'sel',opts:['ASAP','30 days','60 days','No rush']},
    {id:'offers',lbl:'Other Offers',type:'sel',opts:['No','Yes','Talking']},
  ]},
];

// ================================================================
// STATE
// ================================================================
let A={}, M={}, O={req:true}, P={};
let gYr='1970', gSqft='1400';

function vis(q){return !q.showIf||A[q.showIf.f]===q.showIf.v;}
function has(q){return q.type==='chk'?(M[q.id]&&M[q.id].length>0):(A[q.id]!==undefined&&A[q.id]!=='');}
function secP(sec){let t=0,a=0;sec.qs.forEach(q=>{if(!vis(q))return;t++;if(has(q))a++;});return{t,a};}
function reqOk(){return SECS[0].qs.filter(q=>q.req&&vis(q)).every(q=>has(q));}

// Preserve scroll + focus on re-render
function getScroll(){const el=document.querySelector('.body');return el?el.scrollTop:0;}
function setScroll(v){const el=document.querySelector('.body');if(el)el.scrollTop=v;}
function getFocus(){
  const el=document.activeElement;
  if(!el||!el.closest||!el.closest('.gauge,.sec-body'))return null;
  // Save enough to re-find the element
  const tag=el.tagName,oninput=el.getAttribute('oninput')||'';
  const cursor=el.selectionStart||0;
  return {tag,oninput,cursor};
}
function restoreFocus(info){
  if(!info)return;
  const candidates=document.querySelectorAll(info.tag.toLowerCase()+'[oninput]');
  for(const el of candidates){
    if((el.getAttribute('oninput')||'')===info.oninput){
      el.focus();
      try{el.setSelectionRange(info.cursor,info.cursor);}catch(e){}
      return;
    }
  }
}

let _debounce=null;
function set(id,v){A[id]=(A[id]===v?'':v);R();}
function sv(id,v){A[id]=v;Rd();}  // debounced for text inputs
function tg(id,v){if(!M[id])M[id]=[];const i=M[id].indexOf(v);i>=0?M[id].splice(i,1):M[id].push(v);R();}
let _scrollToSec=null;
function ts(id){O[id]=!O[id];if(O[id])_scrollToSec=id;R();}
function pb(id){P[id]=!P[id];R();}
function setYr(v){gYr=v;Rd();}
function setSqft(v){gSqft=v;Rd();}

// Debounced render for text inputs ‚Äî only update gauge, not full DOM
function Rd(){
  clearTimeout(_debounce);
  _debounce=setTimeout(()=>{
    // Just update gauge numbers without full re-render
    const score=calcScore(),letter=scoreToLetter(score);
    const yr=parseInt(gYr)||0, sf=parseInt(gSqft)||0;
    const hasP=yr>1800&&yr<=2026&&sf>0;
    const thumb=document.querySelector('.gauge-thumb');
    const gEl=document.querySelector('.gauge-grade');
    const dEl=document.querySelector('.gauge-desc');
    const cEl=document.querySelector('.gauge-cost-val');
    const clEl=document.querySelector('.gauge-cost-lbl');
    if(thumb)thumb.style.left='calc('+score+'% - 3px)';
    if(gEl){gEl.textContent=letter;gEl.className='gauge-grade g'+letter;}
    if(dEl)dEl.textContent=letterDesc(letter);
    if(cEl)cEl.textContent=hasP?'$'+renoCalc(yr,sf,letter).toLocaleString():'‚Äî';
    if(clEl)clEl.textContent=hasP?'est. rehab':'enter yr + sqft';
  },80);
}

// ================================================================
// RENDER HELPERS
// ================================================================
function rChk(q){
  const sel=M[q.id]||[];
  return `<div class="cbl">${q.opts.map(o=>{
    const on=sel.includes(o);
    return `<div class="cb${on?' on':''}" onclick="tg('${q.id}','${o.replace(/'/g,"\\'")}')"><span class="bx">${on?'‚úì':''}</span>${o}</div>`;
  }).join('')}</div>`;
}

function rPills(q){
  const v=A[q.id]||'',negs=q.neg||[];
  return `<div class="pills">${q.opts.map(o=>
    `<span class="p${negs.includes(o)?' neg':''}${v===o?' on':''}" onclick="set('${q.id}','${o.replace(/'/g,"\\'")}')">${o}</span>`
  ).join('')}</div>`;
}

function rYrPills(yrId){
  const yrOpts=['<5','5-10','10+'];
  const yv=A[yrId]||'';
  return `<div class="yr-row"><span class="yr-hint">updated yr</span><div class="yr-pills">${yrOpts.map(o=>
    `<span class="p${yv===o?' on':''}" onclick="set('${yrId}','${o}')">${o}</span>`
  ).join('')}</div></div>`;
}

function rIn(q){
  const v=A[q.id]||'';
  if(q.type==='chk') return rChk(q);
  if(q.type==='sel'&&q.yrId) return `<div class="combo-row">${rPills(q)}${rYrPills(q.yrId)}</div>\n`;
  if(q.type==='sel') return rPills(q);
  if(q.type==='price') return `<div style="display:flex;align-items:center;gap:3px;">
    <span style="font-size:11px;font-weight:700;color:#334155;">$</span>
    <input class="inp inp-price" type="text" value="${v}" placeholder="0" oninput="sv('${q.id}',this.value)"/>
  </div>`;
  if(q.type==='area') return `<textarea class="inp" rows="2" placeholder="${q.ph||''}" oninput="sv('${q.id}',this.value)">${v}</textarea>`;
  return `<input class="inp" value="${v}" placeholder="${q.ph||''}" oninput="sv('${q.id}',this.value)"/>`;
}

function rQ(q,idx){
  if(!vis(q)) return '';
  const h=has(q),alt=idx%2===1;
  return `<div class="q${alt?' alt':''}">
    <div class="q-top">
      <span class="q-lbl">${q.lbl}${q.req?'<span class="q-req">*</span>':''}${h?'<span class="q-chk">‚úì</span>':''}</span>
      ${q.probe&&!h?`<span style="font-size:10px;color:#94A3B8;cursor:pointer;" onclick="pb('${q.id}')" title="Probe">üîç</span>`:''}
    </div>
    ${rIn(q)}
    ${P[q.id]&&q.probe?`<div class="probe">üí° "${q.probe}"</div>`:''}
  </div>`;
}

function rSec(sec){
  const p=secP(sec),isO=!!O[sec.id];
  const bc=p.a===p.t&&p.t>0?'done':p.a>0?'part':'mt';
  let vi=0;
  const isReq = sec.id==='req';
  return `<div class="sec">
    <div class="sec-h${isReq?' req-h':''}" onclick="ts('${sec.id}')">
      <span class="sec-t">${sec.t}<span class="sec-b ${bc}">${p.a}/${p.t}</span></span>
      <span class="sec-arr${isO?' open':''}">‚ñ∂</span>
    </div>
    ${isO?`<div class="sec-body">${sec.qs.map(q=>{if(!vis(q))return '';return rQ(q,vi++);}).join('')}</div>`:''}
  </div>`;
}

// ================================================================
// MAIN RENDER
// ================================================================
function R(){
  const scrollPos = getScroll();
  const focusInfo = getFocus();

  const score = calcScore();
  const letter = scoreToLetter(score);
  const desc = letterDesc(letter);
  const cls = letterClass(letter);

  // Reno cost from formula
  const yr = parseInt(gYr) || 0;
  const sf = parseInt(gSqft) || 0;
  const hasProperty = yr > 1800 && yr <= 2026 && sf > 0;
  let costStr = '‚Äî';
  if(hasProperty){
    const cost = renoCalc(yr, sf, letter);
    costStr = '$' + cost.toLocaleString();
  }

  // Thumb position: score 0-100 maps to 0-100%
  const thumbPct = score;

  const rd = reqOk();
  let ta=0,tt=0;
  SECS.forEach(s=>{const p=secP(s);ta+=p.a;tt+=p.t;});
  const reqLeft = SECS[0].qs.filter(q=>q.req&&vis(q)).filter(q=>!has(q)).length;
  const fs = rd
    ? '<span style="color:#16A34A;">‚úì Required done</span>'
    : '<b style="color:#EF4444;">'+reqLeft+'</b> req left';

  // Active letter highlight
  const letters = ['F','D','C','B','A'];

  document.getElementById('w').innerHTML = `
    <div class="hdr">
      <span class="hdr-t">Seller Questionnaire</span>
      <span class="hdr-stat">${ta}/${tt} answered</span>
    </div>

    <div class="gauge">
      <div class="gauge-inputs">
        <div style="flex:1;"><label>Year Built</label>
          <input type="text" value="${gYr}" placeholder="e.g. 1990" oninput="setYr(this.value)" maxlength="4"/></div>
        <div style="flex:1;"><label>Sq Ft</label>
          <input type="text" value="${gSqft}" placeholder="e.g. 1500" oninput="setSqft(this.value)"/></div>
      </div>
      <div class="gauge-bar"><div class="gauge-thumb" style="left:calc(${thumbPct}% - 3px);"></div></div>
      <div class="gauge-letters">${letters.map(l=>
        `<span class="${l===letter?'active':''}">${l}</span>`
      ).join('')}</div>
      <div class="gauge-bottom">
        <div style="display:flex;align-items:baseline;">
          <span class="gauge-grade ${cls}">${letter}</span>
          <span class="gauge-desc">${desc}</span>
        </div>
        <div class="gauge-cost">
          <div class="gauge-cost-val">${costStr}</div>
          <div class="gauge-cost-lbl">${hasProperty?'est. rehab':'enter yr + sqft'}</div>
        </div>
      </div>
    </div>

    <div class="body">
      ${SECS.map(s=>rSec(s)).join('')}
      <div class="notes-sec">
        <div class="notes-lbl">Notes</div>
        <textarea class="notes-box" placeholder="Anything else about the property‚Ä¶" oninput="sv('_notes',this.value)">${A['_notes']||''}</textarea>
      </div>
    </div>

    <div class="foot">
      <div class="foot-div"></div>
      <button class="btn-offer">Save Offer</button>
    </div>`;

  // Restore scroll + focus, then auto-scroll opened section into view
  requestAnimationFrame(()=>{
    setScroll(scrollPos);
    restoreFocus(focusInfo);
    if(_scrollToSec){
      const secEl=document.querySelector('[onclick="ts(\''+_scrollToSec+'\')"]');
      if(secEl){
        const body=document.querySelector('.body');
        const rect=secEl.getBoundingClientRect();
        const bodyRect=body.getBoundingClientRect();
        const offset=rect.top-bodyRect.top+body.scrollTop;
        body.scrollTo({top:offset-4,behavior:'smooth'});
      }
      _scrollToSec=null;
    }
  });
}

R();
</script>
</body>
</html>